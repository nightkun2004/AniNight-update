<!DOCTYPE html>
<html lang="th_TH">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏°‡∏µ‡∏° - Meme</title>
  <link rel="stylesheet" href="/css/index.css">
  <link rel="shortcut icon" href="/logo/favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="/logo/favicon.png" type="image/x-icon">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
  <script src="/cdn/tailwincss.js"></script>
  <script src="/cdn/fontawesome.js" crossorigin="anonymous"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6579807593228261"
    crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LTJP520FN4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-LTJP520FN4');
  </script>
  <style>
    body::-webkit-scrollbar {
      display: none;
    }

    section {
      overflow-y: auto;
      overflow-x: hidden;
    }
  </style>
</head>

<body class="bg-gray-100">

    <%- include('../Component/Header') %>
      <section class="bg-white md:p-6 mx-auto max-w-6xl">
        <h2 class="font-normal text-2xl p-2 mt-7 mb-5">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</h2>
        <!-- Display success or error messages -->
        <% if (typeof msg !=='undefined' ) { %>
          <p class="text-center bg-gray-200 rounded-lg text-green-500 font-bold p-5 mb-4">
            <%= msg %>
          </p>
          <% } %>

            <% if (typeof error !=='undefined' ) { %>
              <p class="text-center bg-gray-200 rounded-lg text-red-500 font-bold p-5 mb-4">
                <%= error %>
              </p>
              <% } %>

                <form id="memeForm" action="/api/v2/post/meme/new" method="POST" enctype="multipart/form-data"
                  class="space-y-4 p-6">
                  <!-- Meme Description -->
                  <div class="mt-5">
                    <label for="description" class="block text-gray-600 font-bold mb-2">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏°‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
                    <textarea name="description" id="description" cols="30"
                      class="w-full h-64 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-300"></textarea>
                  </div> 

                  <div class="mb-5">
                    <div class="flex">
                      <label for="t">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏´‡∏°</label>
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox" aria-describedby="helper-checkbox-text" type="checkbox" id="published" name="published"
                             class="w-4 h-4 p-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                        </div>
                        <div class="ms-2 text-sm">
                            <label for="helper-checkbox" class="font-medium text-gray-900 dark:text-gray-300">‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</label>
                        </div>
                    </div>
                </div>

                  <!-- Meme Image Upload -->
                  <div>
                    <label for="file" class="block text-gray-600 font-bold mb-2">‡∏†‡∏≤‡∏û‡∏°‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
                    <input type="file" id="file" name="file" accept=".mp4,.jpg,.jpeg"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-300"
                      required>
                    <p class="font-light text-sm">‡πÇ‡∏õ‡∏£‡∏î‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 1GB ‡∏´‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ô‡∏≤‡∏ô
                    </p>
                    <p class="font-light text-sm">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .jpg .jpeg .mp4 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô !
                    </p>
                  </div>

                  <!-- Upload Status Bar -->
                  <div class="mt-3">
                    <div id="statusBar" class="bg-gray-200 rounded-md h-2">
                      <div id="progressBar" class="bg-blue-500 h-2 rounded-md" style="width: 0%;"></div>
                    </div>
                    <p class="text-red-500 font-light text-base">‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üëáüèª</p>
                    <p id="statusText" class="text-sm font-bold text-gray-600 mt-1"></p>
                  </div>

                  <!-- Submit Button -->
                  <button type="submit"
                    class="w-full bg-blue-500 text-white p-3 rounded-md font-bold hover:bg-blue-600 transition duration-300">
                    ‡∏™‡πà‡∏á‡∏°‡∏µ‡∏°
                  </button>
                </form>

      </section>

      <%- include('../Component/Footer') %>

  <script>
    const form = document.getElementById('memeForm');
    const progressBar = document.getElementById('progressBar');
    const statusText = document.getElementById('statusText');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      const formData = new FormData(form);
      const xhr = new XMLHttpRequest();

      xhr.open('POST', form.action, true);

      // ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤
      xhr.upload.onprogress = (event) => {
        if (event.lengthComputable) {
          const percent = Math.round((event.loaded * 100) / event.total);
          // ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà 90%
          const progressPercent = percent < 90 ? percent : 90;
          progressBar.style.width = progressPercent + '%';
          statusText.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î... ${progressPercent}%`;
        }
      };

      xhr.onload = () => {
        if (xhr.status >= 200 && xhr.status < 300) {
          try {
            const response = JSON.parse(xhr.responseText);
            if (response && response.status === 'ok') {
              // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏≤‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô 90%
              progressBar.style.width = '90%';
              statusText.textContent = '‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå...';

              // ‡∏£‡∏≠ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô 100%
              setTimeout(() => {
                progressBar.style.width = '100%';
                statusText.textContent = `‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå! ${response.msg}`;
                form.reset();
              }, 5000);
            } else {
              statusText.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + (response.msg || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
            }
          } catch (e) {
            console.error('Error parsing server response:', e);
            statusText.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå';
          }
        } else {
          console.error('Upload failed:', xhr.statusText || 'Unknown error');
          statusText.textContent = `‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${xhr.statusText || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'}`;
        }
      };

      xhr.onerror = () => {
        console.error('Upload failed:', xhr.statusText || 'Unknown error');
        statusText.textContent = `‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${xhr.statusText || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'}`;
      };

      // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°
      xhr.send(formData);
    });
  </script>


</body>

</html>
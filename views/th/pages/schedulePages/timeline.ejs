<!DOCTYPE html>
<html lang="<%= lang %>">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ตารางฉายอนิเมะ</title>
  <meta name="description"
    content="ติดตามข่าวสารล่าสุดเกี่ยวกับอนิเมะ อ่านบทความที่น่าสนใจ และอัปเดตตารางอนิเมะได้ที่ AniNight">
  <meta name="keywords"
    content="อ่านบทความ, ข่าวอนิเมะ, ตารางอนิเมะ, อนิเมะพากย์ไทย, มังงะ, manga, anime, ออนไลน์, AniNight, อนิเมะไนท์, ตารางฉายอนิเมะ">
  <meta name="author" content="ทีมงาน Ani Night">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Canonical and SEO Meta -->
  <link rel="canonical" href="https://ani-night.online/schedule/timeline">
  <meta property="og:url" content="https://ani-night.online/schedule/timeline">
  <meta property="og:title" content="AniNight - แพลตฟอร์มข่าวสารและบทความเกี่ยวกับอนิเมะ">
  <meta property="og:description"
    content="ติดตามข่าวสารอนิเมะ บทความสุดพิเศษ และตารางอนิเมะล่าสุดได้ที่ AniNight! สร้างสรรค์เนื้อหาและสร้างรายได้ผ่านเครื่องมือของเรา">
  <meta property="og:image" content="https://ani-night.online/annight/home_web.jpg">
  <meta property="og:locale" content="th_TH">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="AniNight">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1280">
  <meta property="og:image:height" content="720">

  <!-- CSS & JS -->
  <link rel="shortcut icon" href="/logo/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="/css/pages/schedule.css">
  <script src="/css/tailwindcss.css"></script>
  <script src="/js/fontawesome.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" async></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6579807593228261"
    crossorigin="anonymous"></script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-X2HYDKP19Y"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-X2HYDKP19Y');
  </script>
  <style>
    .truncate {
      white-space: nowrap;
      /* ห้ามข้อความไปอยู่ในบรรทัดใหม่ */
      overflow: hidden;
      /* ซ่อนข้อความที่เกิน */
      text-overflow: ellipsis;
    }
  </style>
</head>

<body class="bg-gray-100 text-black font-sans">

  <!-- Header -->
  <%- include('../../Component/Header') %>
    <main class="mb-5 mt-7 mx-auto max-w-6xl px-4 z-10">
      <div class="schedule-navigation flex items-center justify-between mb-4">
        <button id="prev-day" class="bg-gray-200 px-4 py-2 rounded-full shadow-md hover:bg-gray-300">
          <svg width="12px" height="12px" viewBox="0 0 1024 1024" class="icon" version="1.1"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M768 903.232l-50.432 56.768L256 512l461.568-448 50.432 56.768L364.928 512z" fill="#000000" />
          </svg>
        </button>
        <div class="text-center text-gray-600">
          <h4>วันนี้</h4>
          <p>
            <%= currentDate %>
          </p>
          <span>ตารางฉายอนิเมะ</span>
        </div>
        <button id="next-day" class="bg-gray-200 px-4 py-2 rounded-full shadow-md hover:bg-gray-300">
          <svg fill="#000000" height="13px" width="13px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 330 330" xml:space="preserve">
            <path id="XMLID_222_" d="M250.606,154.389l-150-149.996c-5.857-5.858-15.355-5.858-21.213,0.001
                           c-5.857,5.858-5.857,15.355,0.001,21.213l139.393,139.39L79.393,304.394c-5.857,5.858-5.857,15.355,0.001,21.213
                           C82.322,328.536,86.161,330,90,330s7.678-1.464,10.607-4.394l149.999-150.004c2.814-2.813,4.394-6.628,4.394-10.606
                           C255,161.018,253.42,157.202,250.606,154.389z" />
          </svg>
        </button>
      </div>

      <div class="schedule-container relative">
        <!-- ตัวห่อสำหรับการเลื่อน -->
        <div class="schedule-days flex overflow-x-auto gap-4 snap-x snap-mandatory scroll-smooth">
          <% schedule.forEach(day=> { %>
            <div class="schedule-day bg-white shadow rounded-lg p-4 min-w-[330px] h-full snap-start" <% const
              isToday=moment(day.date).format('DD/MM')===currentDate; const backgroundStyle=isToday
              ? 'border: #fff 3px solid; background: linear-gradient(180deg,  rgba(198,231,255,1) 7%, rgb(242 246 247) 60%);'
              : '' ; %>
              style="<%= backgroundStyle %>"
              <%- isToday ? 'id="today-schedule"' : '' %>
                  >
                  <div class="flex flex-col text-center">
                    <h2 class="text-xl font-semibold text-gray-500 mb-4">
                      <% if (moment(day.date).isSame(moment(), 'day' )) { %>
                        วันนี้
                        <% } else { %>
                          <%= moment(day.date).format('DD/MM') %>
                            <% } %>
                              <% const dayMapping={ Monday: 'จันทร์' , Tuesday: 'อังคาร' , Wednesday: 'พุธ' ,
                                Thursday: 'พฤหัสบดี' , Friday: 'ศุกร์' , Saturday: 'เสาร์' , Sunday: 'อาทิตย์' }; const
                                dayInThai=dayMapping[day.day] || day.day; %>
                    </h2>
                    <span class="-mt-5 text-gray-500">วัน<%= dayInThai %></span>
                  </div>

                  <% day.animes.forEach(animeItem=> { %>
                    <div class="anime-item flex items-center space-x-4 mb-4">
                      <div class="anime-image flex-shrink-0">
                        <% if (animeItem.anime.poster && animeItem.anime.poster.startsWith('http')) { %>
                          <img src="<%= animeItem.anime.poster %>" alt="<%= animeItem.anime.title.en %>"
                            class="w-24 h-24 object-contain rounded-lg">
                          <% } else { %>
                            <img src="/uploads/posters/<%= animeItem.anime.poster %>"
                              alt="<%= animeItem.anime.title.en %>" class="w-24 h-24 object-contain rounded-lg">
                            <% } %>
                      </div>
                      <div class="anime-details">
                        <h3 class="text-lg font-bold truncate">
                          <a href="/anime/<%= animeItem.anime.urlslug %>">
                            <%= (animeItem.anime.title.th || animeItem.anime.title.en).length> 20
                              ? (animeItem.anime.title.th || animeItem.anime.title.en).substring(0, 20) + "..."
                              : (animeItem.anime.title.th || animeItem.anime.title.en) %>
                          </a>
                        </h3>
                        <p class="text-sm text-gray-600">
                          <% if (animeItem.anime.episodes) { %>
                              <strong
                                  class="<%= animeItem.anime.episodes.current !== 0 ? 'text-blue-500 font-medium' : '' %>">
                                  ตอนที่ <%= animeItem.anime.episodes.current %>
                                  <% 
                                      // ตรวจสอบเวลาปัจจุบันและเวลาของอนิเมะ
                                      const animeTime = moment(animeItem.time, 'HH:mm');
                                      const now = moment().tz('Asia/Bangkok');
                                      const isUpdating = now.isSameOrAfter(animeTime);
                      
                                      if (isUpdating) { %>
                                      กำลังอัปเดต
                                  <% } else { %>
                                      กำลังจะอัปเดต
                                  <% } %>
                              </strong>
                              <span>จากตอนทั้งหมด <%= animeItem.anime.episodes.total %></span>
                          <% } else { %>
                              <span>ไม่มีข้อมูลตอน</span>
                          <% } %>
                      </p>
                      
                        <span class="time text-blue-500 font-medium">
                          <%= animeItem.time || 'ไม่ระบุเวลา' %>
                        </span>
                      </div>
                    </div>
                    <% }) %>

            </div>
            <% }) %>
        </div>

      </div>


    </main>

    <!-- Footer -->
    <%- include('../../Component/Footer') %>

      <script src="/js/script.js" defer></script>
      <script defer>
        document.addEventListener('DOMContentLoaded', () => {
          const todaySchedule = document.getElementById('today-schedule');
          const scheduleContainer = document.querySelector('.schedule-days');
          const prevDay = document.getElementById('prev-day');
          const nextDay = document.getElementById('next-day');

          if (todaySchedule) {
            console.log('Today schedule found, scrolling...');
            todaySchedule.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
          } else {
            console.log('Today schedule not found');
          }

          prevDay.addEventListener('click', () => {
            scheduleContainer.scrollBy({ left: -330, behavior: 'smooth' });
          });

          nextDay.addEventListener('click', () => {
            scheduleContainer.scrollBy({ left: 330, behavior: 'smooth' });
          });
        });
      </script>
      
</body>

</html>